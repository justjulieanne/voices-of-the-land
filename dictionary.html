<!doctype html><html><head>
  <meta charset="utf-8">
  <title>Voices of the Land — Dictionary (Cree)</title>
  <meta name="viewport" content="width=device-width,initial-scale:1" />
  <style>
    :root{--bg:#f5efe6;--card:#fff9f2;--accent:#8a4b2a;--muted:#6b5847;}
    body{font-family:Inter, Arial, sans-serif;background:var(--bg);color:var(--muted);padding:20px;margin:0;}
    .wrap{max-width:900px;margin:0 auto;background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.05)}
    h1{color:var(--accent);margin:0 0 8px}
    .entry{border-bottom:1px dashed #e7ded4;padding:12px 0}
    .word{font-size:18px;font-weight:700;color:#3f2b20}
    .meta{font-size:13px;color:#7a6a5f;margin-top:6px}
    .translation{margin-top:6px; padding-left: 10px;}
    audio{margin-top:8px;width:100%}
    .main-nav{background-color:var(--accent);border-radius:8px;margin-bottom:20px;overflow:hidden;}
    .main-nav ul{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap;justify-content:center;}
    .main-nav a{display:block;padding:12px 18px;text-decoration:none;color:white;font-weight:600;font-size:15px;}
    .main-nav a:hover{background-color:var(--accent-2);}
  </style></head><body>
  <div class="wrap">
    <nav class="main-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="submit.html">Submit a Word</a></li>
        <li><a href="dictionary.html">Public Dictionary</a></li>
        <li><a href="admin.html">Admin Review</a></li>
      </ul>
    </nav>

    <h1>Public Dictionary (Verified)</h1>
    <p class="meta">Compiled entries verified by community Elders. This list updates in real-time.</p>
    <div id="list"><p>Loading dictionary...</p></div>
  </div>

  <!-- Import Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, query, where, onSnapshot, setLogLevel } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // --- Firebase Config ---
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
    
    let db, auth;
    let wordsCollection;

    const container = document.getElementById('list');

    // --- Initialization ---
    try {
      setLogLevel('debug');
      const app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);

      // Sign in the user
      if (authToken) {
        await signInWithCustomToken(auth, authToken);
      } else {
        await signInAnonymously(auth);
      }
      
      // Define the public collection path
      wordsCollection = collection(db, 'artifacts', appId, 'public', 'data', 'words');

      // Load the dictionary
      loadDictionary();

    } catch (e) {
      console.error("Firebase Init Error:", e);
      container.innerHTML = "<p>Error: Could not connect to database.</p>";
    }

    function loadDictionary() {
      // Create a query to get only VERIFIED words
      const q = query(wordsCollection, where("verified", "==", true));

      // onSnapshot listens for real-time updates.
      // The page will automatically update when a new word is verified.
      onSnapshot(q, (querySnapshot) => {
        if (querySnapshot.empty) {
          container.innerHTML = "<p>No verified entries yet.</p>";
          return;
        }

        container.innerHTML = ""; // Clear the list
        
        // Sort the data in memory (JavaScript sort)
        const entries = [];
        querySnapshot.forEach(doc => {
            entries.push(doc.data());
        });
        
        // Sort by indigenousText, case-insensitive
        entries.sort((a, b) => {
            return a.indigenousText.localeCompare(b.indigenousText, undefined, { sensitivity: 'base' });
        });

        entries.forEach(e => {
          const div = document.createElement('div');
          div.className = "entry";
          
          const timestamp = e.createdAt ? new Date(e.createdAt.seconds * 1000).toLocaleString() : 'Unknown date';
          
          div.innerHTML = `
            <div class="word">${e.indigenousText}</div>
            <div class="translation"><b>English:</b> ${e.englishText}</div>
            ${e.frenchText ? `<div class="translation"><b>French:</b> ${e.frenchText}</div>` : ""}
            <div class="meta">Community: ${e.community || "Cree"} • Submitted by: ${e.submitterName || "Anonymous"} • ${timestamp}</div>
            ${e.notes ? `<div style="margin-top:8px;font-size:14px">Notes: ${e.notes}</div>` : ""}
          `;
          container.appendChild(div);
        });

      }, (error) => {
        console.error("Error loading dictionary: ", error);
        container.innerHTML = "<p>Error loading dictionary. Please try again.</p>";
      });
    }
  </script>
</body></html>
