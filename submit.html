<!doctype html><html><head>
  <meta charset="utf-8" />
  <title>Voices of the Land â€” Submit (Cree)</title>
  <meta name="viewport" content="width=device-width,initial-scale:1" />
  <style>
    :root{--bg:#f5efe6; --card:#fff9f2; --accent:#8a4b2a; --accent-2:#b33a2a; --muted:#6b5847;}
    body{font-family:Inter, Arial, sans-serif;background:var(--bg);color:var(--muted);padding:22px;margin:0;}
    .wrap{max-width:720px;margin:0 auto;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.06);}
    h1{color:var(--accent);margin:0 0 6px;font-size:20px}
    label{display:block;margin-top:12px;font-weight:600}
    input[type=text], textarea, select {width:100%;padding:10px;border:1px solid #e6dcd1;border-radius:8px;margin-top:6px;}
    .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
    button{background:var(--accent);color:white;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
    button.secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}
    button:disabled{background-color:#ccc;cursor:not-allowed;}
    .muted{color:#7a6a5f;font-size:13px}
    .consent{margin-top:10px;display:flex;align-items:center;gap:8px}
    audio{margin-top:8px;width:100%}
    .result{margin-top:12px;font-weight:600}
    .main-nav{background-color:var(--accent);border-radius:8px;margin-bottom:20px;overflow:hidden;}
    .main-nav ul{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap;justify-content:center;}
    .main-nav a{display:block;padding:12px 18px;text-decoration:none;color:white;font-weight:600;font-size:15px;}
    .main-nav a:hover{background-color:var(--accent-2);}
  </style>
</head>
<body>
  <div class="wrap">
    <nav class="main-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="submit.html">Submit a Word</a></li>
        <li><a href="dictionary.html">Public Dictionary</a></li>
        <li><a href="admin.html">Admin Review</a></li>
      </ul>
    </nav>
    
    <h1>Submit a Word (Cree)</h1>
    <p class="muted">Share a word or phrase. Submissions will be reviewed by community Elders before being published.</p>

    <label>Community
      <select id="community" aria-label="community">
        <option value="Cree">Cree</option>
      </select>
    </label>

    <label>Submitter name (optional)
      <input id="submitter" type="text" placeholder="Your name (or leave blank for anonymous)" />
    </label>

    <label>Indigenous text (word or phrase)
      <input id="indigenousText" type="text" placeholder="Enter word or phrase in Cree" />
    </label>

    <label>English translation
      <input id="englishText" type="text" placeholder="Enter English translation" />
    </label>

    <label>French translation
      <input id="frenchText" type="text" placeholder="Enter French translation" />
    </label>

    <label>Notes (usage, dialect notes, context)
      <textarea id="notes" rows="3" placeholder="Optional notes for Elders or learners"></textarea>
    </label>

    <!-- Audio recording is a complex feature with Firebase Storage.
         For this version, I've removed the audio button to focus on the database.
         We can add audio back later as a separate, bigger upgrade. -->
    
    <div class="consent">
      <input type="checkbox" id="consent" />
      <label for="consent">I confirm I have permission to share this word, and understand it may be made public after Elder verification.</label>
    </div>

    <div style="margin-top:14px;">
      <button id="submitBtn">Submit</button>
      <button id="clearBtn" class="secondary">Clear</button>
    </div>

    <div id="result" class="result"></div>
  </div>

  <!-- Import Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, addDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // --- Firebase Config ---
    // These variables are provided by the environment.
    const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const authToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
    
    let db, auth;
    let wordsCollection;
    let currentUserId;

    // --- DOM Elements ---
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const resultEl = document.getElementById('result');

    // --- Initialization ---
    try {
      setLogLevel('debug');
      const app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);

      // Sign in the user (anonymously or with token)
      if (authToken) {
        await signInWithCustomToken(auth, authToken);
      } else {
        await signInAnonymously(auth);
      }
      currentUserId = auth.currentUser.uid;
      
      // Define the public collection path
      wordsCollection = collection(db, 'artifacts', appId, 'public', 'data', 'words');

    } catch (e) {
      console.error("Firebase Init Error:", e);
      resultEl.textContent = "Error: Could not connect to database.";
      resultEl.style.color = "red";
    }

    // --- Event Handlers ---
    clearBtn.onclick = () => {
      document.getElementById('submitter').value = "";
      document.getElementById('indigenousText').value = "";
      document.getElementById('englishText').value = "";
      document.getElementById('frenchText').value = "";
      document.getElementById('notes').value = "";
      document.getElementById('consent').checked = false;
      resultEl.textContent = "";
    };

    submitBtn.onclick = async () => {
      const submitter = document.getElementById('submitter').value.trim();
      const community = document.getElementById('community').value;
      const indigenousText = document.getElementById('indigenousText').value.trim();
      const englishText = document.getElementById('englishText').value.trim();
      const frenchText = document.getElementById('frenchText').value.trim();
      const notes = document.getElementById('notes').value.trim();
      const consent = document.getElementById('consent').checked;

      if (!indigenousText || !englishText) {
        resultEl.textContent = "Please provide at least Indigenous text and English translation.";
        resultEl.style.color = "red";
        return;
      }
      if (!consent) {
        resultEl.textContent = "Please check the consent box before submitting.";
        resultEl.style.color = "red";
        return;
      }

      // Disable button
      submitBtn.disabled = true;
      resultEl.textContent = "Submitting...";
      resultEl.style.color = "var(--muted)";

      try {
        // Create the new document for Firestore
        const newWord = {
          submitterName: submitter,
          submitterId: currentUserId,
          community: community,
          indigenousText: indigenousText,
          englishText: englishText,
          frenchText: frenchText,
          notes: notes,
          consent: consent,
          verified: false, // <-- Set to false by default for review
          createdAt: serverTimestamp() // Adds a server-side timestamp
        };

        // Add the new document to the 'words' collection
        const docRef = await addDoc(wordsCollection, newWord);
        
        resultEl.textContent = "Submitted! Thank you. It will be reviewed by Elders.";
        resultEl.style.color = "green";
        clearBtn.click(); // Clear the form

      } catch (e) {
        console.error("Error adding document: ", e);
        resultEl.textContent = "Error: Could not submit. Please try again.";
        resultEl.style.color = "red";
      } finally {
        submitBtn.disabled = false;
      }
    };
  </script>
</body></html>
