<!doctype html><html><head>
  <meta charset="utf-8">
  <title>Voices of the Land — Admin Review</title>
  <meta name="viewport" content="width=device-width,initial-scale:1" />
  <style>
    :root{--bg:#f5efe6;--card:#fff9f2;--accent:#8a4b2a;--accent-2:#b33a2a;--muted:#6b5847;}
    body{
      font-family:Inter, Arial, sans-serif;
      background-color:var(--bg);
      color:var(--muted);
      padding:20px;
      margin:0;
      /* Medicine Wheel Flower Background */
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60' viewBox='0 0 60 60'%3E%3Cpath d='M30 10 C20 10 20 20 30 30 C40 20 40 10 30 10' fill='%23FFFFFF' fill-opacity='0.7'/%3E%3Cpath d='M30 50 C20 50 20 40 30 30 C40 40 40 50 30 50' fill='%23B33A2A' fill-opacity='0.5'/%3E%3Cpath d='M10 30 C10 20 20 20 30 30 C20 40 10 40 10 30' fill='%23333333' fill-opacity='0.5'/%3E%3Cpath d='M50 30 C50 20 40 20 30 30 C40 40 50 40 50 30' fill='%23FFD700' fill-opacity='0.5'/%3E%3C/svg%3E");
    }
    /* Hide the main content by default */
    .wrap{
      max-width:920px;
      margin:0 auto;
      background: rgba(255, 249, 242, 0.98); /* 98% opacity */
      padding:18px;
      border-radius:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.05); 
      display: none;
    }
    h1{color:var(--accent);margin:0 0 8px}
    .entry{border:1px solid #e6dcd1;padding:12px;border-radius:8px;margin-bottom:10px}
    .entry-buttons{margin-top:10px;display:flex;gap:8px;}
    button{background:var(--accent);color:white;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
    button.decline{background-color:transparent;color:var(--accent-2);border:1px solid var(--accent-2);}
    button:disabled{background-color:#ccc;cursor:not-allowed;}
    .secondary{background:transparent;color:var(--accent);border:1px solid var(--accent)}
    .main-nav{background-color:var(--accent);border-radius:8px;margin-bottom:20px;overflow:hidden;}
    .main-nav ul{list-style:none;margin:0;padding:0;display:flex;flex-wrap:wrap;justify-content:center;}
    .main-nav a{display:block;padding:12px 18px;text-decoration:none;color:white;font-weight:600;font-size:15px;}
    .main-nav a:hover{background-color:var(--accent-2);}
    
    /* --- UPDATED ERROR MESSAGE STYLE --- */
    #errorMessage{
      padding:20px;
      text-align:center;
      font-weight:600;
      color:var(--accent-2);
      display:none;
      background: rgba(255, 249, 242, 0.98);
      border-radius:12px;
      max-width: 920px;
      margin: 0 auto;
    }
    /* --- NEW BUTTON STYLE FOR ERROR PAGE --- */
    #errorMessage button {
        margin-top: 15px;
    }
  </style></head><body>
  
  <div class="wrap" id="mainContent">
    <nav class="main-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="submit.html">Submit a Word</a></li>
        <li><a href="dictionary.html">Public Dictionary</a></li>
        <li><a href="translator.html">Translator</a></li>
        <li><a href="admin.html">Admin Review</a></li>
      </ul>
    </nav>
    
    <h1>Pending Submissions — Elder Review</h1>
    <p class="muted">Use this page to verify or decline entries. Verifying publishes the item to the public dictionary. Declining deletes it permanently.</p>
    <div id="list">Loading...</div>
  </div>

  <!-- --- UPDATED ERROR MESSAGE HTML --- -->
  <div id="errorMessage">
    Access Denied.
    <br>
    <button id="goBackBtn" class="secondary">Go to Home Page</button>
  </div>
  <!-- --- END UPDATE --- -->


<script>
    // --- THIS IS YOUR WORKING LINK ---
    const WEB_APP_BASE = "https://script.google.com/macros/s/AKfycbw27lNpaPmfAktNrBl3eZgQ-xA2xDkMhiC7-_KCfk9RLKdxAE_y_BBFP-ulPC3oO1zHpg/exec";
    // --- END LINK ---
    
    const LIST_PENDING = WEB_APP_BASE + "?cmd=listPending";

    // --- PASSWORD FUNCTION ---
    function checkPassword() {
      const PASSWORD = "CreeAdmin2025"; 
      const entry = prompt("Please enter the Admin Password:");
      if (entry === PASSWORD) {
        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('errorMessage').style.display = 'none';
        loadPending(); // Load data only if password is correct
      } else {
        // --- THIS IS THE FIX ---
        // Show the error message and add the click handler to the new button
        document.getElementById('mainContent').style.display = 'none';
        document.getElementById('errorMessage').style.display = 'block';
        
        document.getElementById('goBackBtn').onclick = function() {
          window.location.href = 'index.html';
        };
        // --- END FIX ---
      }
    }
    // --- END FUNCTION ---
    
    async function handleAction(action, rowIndex, buttonEl) {
        const isDecline = action === 'decline';
        const confirmMsg = isDecline ? 
            "Are you sure you want to permanently decline this submission?" : 
            "Are you sure you want to verify and publish this entry?";

        if (!confirm(confirmMsg)) {
            return;
        }

        buttonEl.disabled = true;
        buttonEl.textContent = isDecline ? "Declining..." : "Verifying...";
        
        try {
            const resp = await fetch(WEB_APP_BASE, {
              method: "POST",
              headers: {"Content-Type":"text/plain;charset=utf-8"},
              body: JSON.stringify({ action: action, rowIndex: rowIndex })
            });
            
            if (!resp.ok) { throw new Error(`HTTP error! Status: ${resp.status}`); }

            const j2 = await resp.json();
            
            if (j2.success) {
                buttonEl.textContent = isDecline ? "Declined ✓" : "Verified ✓";
                // Find and remove the parent .entry div
                let entryDiv = buttonEl.closest('.entry');
                if (entryDiv) {
                    entryDiv.style.transition = 'opacity 0.5s ease-out';
                    entryDiv.style.opacity = '0';
                    setTimeout(() => entryDiv.remove(), 500);
                }
            } else {
                throw new Error(j2.message || "Unknown error");
            }
        } catch (err) {
            console.error("Action Error:", err);
            alert(`Error: ${err.message}. Please refresh and try again.`);
            buttonEl.disabled = false;
            buttonEl.textContent = isDecline ? "Decline (delete)" : "Verify (publish)";
        }
    }

    async function loadPending() {
      const container = document.getElementById('list');
      try {
        const resp = await fetch(LIST_PENDING);
        if (!resp.ok) { throw new Error(`HTTP error! Status: ${resp.status}`); }
        const j = await resp.json();
        
        container.innerHTML = "";
        if (!j.entries || j.entries.length === 0) {
          container.innerHTML = "<p>No pending submissions.</p>";
          return;
        }
        
        j.entries.forEach(e => {
          const div = document.createElement('div'); div.className = "entry";
          const audioLink = `https://drive.google.com/uc?export=download&id=${e.audioId}`;

          // This code now correctly matches the 12-column sheet
          div.innerHTML = `
            <div style="font-weight:700">${e.indigenousText}</div>
            ${e.syllabics ? `<div style="font-size:18px;margin-top:4px;">${e.syllabics}</div>` : ""}
            <div style="margin-top:4px"><b>English:</b> ${e.englishText}</div>
            ${e.frenchText ? `<div style="margin-top:4px"><b>French:</b> ${e.frenchText}</div>` : ""}
            ${e.pronunciation ? `<div style="margin-top:4px"><b>Pronunciation:</b> ${e.pronunciation}</div>` : ""}
            ${e.notes ? `<div style="margin-top:4px;font-style:italic;"><b>Notes:</b> ${e.notes}</div>` : ""}
            <div style="margin-top:6px; font-size: 14px;">Community: ${e.community || "Cree"} • Submitted by: ${e.submitter || "Anonymous"}</div>
            ${e.audioId ? `<div style="margin-top:8px"><audio controls src="${audioLink}"></audio></div>` : ""}
            <div class="entry-buttons">
                <button onclick="handleAction('verify', ${e.rowIndex}, this)">Verify (publish)</button>
                <button class="decline" onclick="handleAction('decline', ${e.rowIndex}, this)">Decline (delete)</button>
            </div>`;
          container.appendChild(div);
        });
        
      } catch (err) {
        console.error("Load Error:", err);
        container.textContent = "Error loading pending submissions: " + err.message;
      }
    }

    // Run the password check as soon as the page loads
    checkPassword();
</script></body></html>
